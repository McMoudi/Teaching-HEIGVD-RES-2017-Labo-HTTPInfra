NameVirtualHost *
<VirtualHost *:80>
        ServerName demo.res.ch

        DocumentRoot /var/www
        ProxyRequests Off

        ProxyPass /balancer-manager !
        ProxyPass /api/students/ balancer://dynamic/ stickysession=BALANCEID nofailover=On
        ProxyPass / balancer://static/ stickysession=BALANCEID nofailover=On

        ProxyPassReverse api/students http://express_dynamic:3000
        ProxyPassReverse api/students http://express_dynamic2:3000
        ProxyPassReverse api/students http://express_dynamic3:3000
        ProxyPassReverse / http://apache_static/
        ProxyPassReverse / http://apache_static2/
        ProxyPassReverse / http://apache_static3/

        Header add Set-Cookie "ROUTE-ID=.%{BALANCER_WORKER_ROUTE}e; path=/" env=BALANCER_ROUTE_CHANGED
        <Proxy balancer://static>
          BalancerMember http://apache_static/  route=static1
          BalancerMember http://apache_static2/  route=static2
          BalancerMember http://apache_static3/  route=static3
          ProxySet stickysession=ROUTEID
        </Proxy>

        <Proxy balancer://dynamic>
                  BalancerMember http://express_dynamic:3000  route=http1
                  BalancerMember http://express_dynamic2:3000  route=http1
                  BalancerMember http://express_dynamic3:3000  route=http1
                  ProxySet lbmethod=byrequests
        </Proxy>

        <Location /balancer-manager>
          SetHandler balancer-manager

          Order deny,allow
          Allow from all
        </Location>

</VirtualHost>